<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>√âtude UX ‚Äì Confiance Leboncoin</title>
<style>
body{margin:0;font-family:Arial,sans-serif;background:#f6f6f6;color:#333}
header{background:#ff6e14;color:#fff;padding:15px;font-size:22px;text-align:center;font-weight:bold}
.page{max-width:900px;margin:20px auto;padding:10px}
.card{display:flex;gap:20px;background:#fff;padding:25px;border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,0.1)}
.seller{width:220px;flex-shrink:0;text-align:center;border-right:1px solid #eee;padding-right:20px}
.seller img{width:110px;height:110px;border-radius:50%;object-fit:cover;margin-bottom:12px;background:#eee}
.seller .info{font-weight:bold;font-size:16px;margin-bottom:8px;color:#000}
.seller .badge{display:inline-block;background:#eef7ff;color:#0078d4;padding:4px 8px;margin:3px;border-radius:4px;font-size:11px;font-weight:bold;border:1px solid #0078d4}
.seller .badge.pro{background:#fff0e5;color:#ff6e14;border-color:#ff6e14}
.seller .rating{font-size:15px;color:#ffb400;margin-top:8px;font-weight:bold}
.seller .numListings{font-size:13px;color:#666;margin-top:5px}

.product{flex:1;display:flex;flex-direction:column;gap:12px}
.gallery-main img#mainImg{width:100%;height:350px;object-fit:contain;border-radius:8px;background:#f9f9f9}

.details h1{margin:0;font-size:24px;display:flex;align-items:center;gap:10px;color:#000}
.details .price{font-size:28px;font-weight:bold;color:#000;margin:10px 0}
.details .old{font-size:16px;text-decoration:line-through;color:#888;margin-left:8px;font-weight:normal}
.details .discount{font-size:16px;color:#ed0000;margin-left:8px}
.details .tag{display:inline-block;font-size:14px;padding:4px 0;color:#333}
.details .tag.secure{color:#2ecc71;font-weight:bold}
.details .tag.warning{color:#e67e22;font-weight:bold}
.details .description{margin-top:15px;padding:12px;border:1px solid #eee;border-radius:6px;background:#fcfcfc;line-height:1.5;font-size:14px;color:#444}
.contact-btn{width:100%;background:#ff6e14;color:white;border:none;padding:15px;font-size:16px;font-weight:bold;border-radius:8px;cursor:pointer;margin-top:15px;transition:0.2s}
.contact-btn:hover{background:#e65c00}

.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);align-items:center;justify-content:center;z-index:100}
.modal-content{background:#fff;padding:30px;width:480px;border-radius:12px;text-align:left}
.modal-content h3{margin-top:0;color:#ff6e14}
.modal-content label{display:block;margin-top:15px;font-size:14px;font-weight:bold}
textarea,select{width:100%;margin-top:8px;padding:10px;border-radius:6px;border:1px solid #ccc;font-size:14px}
textarea{height:80px;resize:none}
.modal-content button{width:100%;background:#333;color:white;border:none;padding:12px;margin-top:20px;border-radius:6px;cursor:pointer;font-weight:bold}

.click-marker{position:fixed;transform:translate(-50%,-50%);pointer-events:none;z-index:9999}
.click-dot{width:20px;height:20px;background:rgba(255,0,0,0.6);border:2px solid red;border-radius:50%}
</style>
</head>
<body>

<header>Leboncoin UX Study - 2026</header>
<div class="page" id="content"></div>

<div class="modal" id="modalConsent" style="display:flex">
  <div class="modal-content">
    <h3>Consent </h3>
    <p>Nous allons analyser vos interactions avec 9 annonces. Vos clics seront enregistr√©s de mani√®re anonyme.</p>
    <button onclick="closeModal('modalConsent');startStudy();">Agree & Continue</button>
  </div>
</div>


<div class="modal" id="modalClick">
  <div class="modal-content">
    <h3>Trust Influence</h3>
    <p>After clicking the button below, <strong>click on the element on the page</strong> that most influenced your trust level.</p>
    <button onclick="enableClickCapture()">I understand</button>
  </div>
</div>

<div class="modal" id="modalSurvey">
  <div class="modal-content">
    <h3>Listing Survey</h3>
    <label>I think this listing is trustworthy (1-5):
      <select id="trust"><option value=""></option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select>
    </label>
    <label>I think this seller is trustworthy (1-5): :
      <select id="sellerTrust"><option value=""></option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select>
    </label>
    <label>Likelihood to contact this seller (1-5):
      <select id="contactLikely"><option value=""></option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select>
    </label>
    <label>Why? (optional)
      <textarea id="reason" placeholder="Ex: Pas de paiement s√©curis√©, vendeur pro, prix trop bas..."></textarea>
    </label>
    <button onclick="submitTrial()">Submit</button>
  </div>
</div>

<div class="modal" id="modalPhaseC">
  <div class="modal-content">
    <h3>Overall Desirability Survey</h3>
    <label>Which listing do you trust most?
      <select id="mostTrusted"></select>
    </label>
    <label>Which UX element most influenced your trust judgment?
      <select id="mostInfluential"><option></option>
        <option>Photos</option>
        <option>Description</option>
        <option>Price</option>
        <option>Seller</option>
        <option>Badges</option>
        <option>Rating</option>
        <option>Other</option>
      </select>
    </label>
    <input type="text" id="otherValue" placeholder="Precise here" style="display:none; margin-top:10px;">
    <button onclick="submitPhaseC()">Submit & Export CSV</button>
  </div>
</div>

<script>
let clickMode = "off", currentTrial = 0, responses = [], clickData = null;

const annonces = [
  {
    id: "A1",
    title: "iPhone 12",
    price: "380,00 ‚Ç¨",
    oldPrice: "520,55 ‚Ç¨",
    disc: "-27%",
    secure: true,
    likes: 15,
    desc: "iPhone 12 en bon √©tat de fonctionnement, r√©initialis√© et pr√™t √† l'emploi. Vente avec c√¢ble de chargement. Exp√©dition seulement.",
    img: "https://img.leboncoin.fr/api/v1/lbcpb1/images/fa/67/af/fa67af61390a2820d2fc2ba7a60055b5c31721e9.jpg?rule=classified-1200x800-webp",
    seller: {
      name: "E.Leclerc",
      badges: ["Pro", "Top Vendeur"],
      rate: 4.0,
      ads: 13,
      photo: "https://img.leboncoin.fr/api/v1/lbcpb1/images/63/a7/b4/63a7b4af-7571-4988-8400-617ed0064931?rule=bo-thumb"
    }
  },
  {
    id: "A2",
    title: "Google Pixel 7",
    price: "189,00 ‚Ç¨",
    oldPrice: "",
    disc: "",
    secure: false, // badge s√©curis√© retir√©
    likes: 23,
    desc: "Google Pixel 7 en tr√®s bon √©tat. R√©initialis√©, pr√™t √† l‚Äôutilisation. C√¢ble inclus.",
    img: "https://img.leboncoin.fr/api/v1/lbcpb1/images/9d/35/ac/9d35ac3233341deb38c9710ea79de6818d5cfc80.jpg?rule=classified-1200x800-webp",
    seller: {
      name: "MARKET PHONE",
      badges: ["Pro", "R√©actif"],
      rate: 5.0,
      ads: 6234,
      photo: "https://img.leboncoin.fr/api/v1/lbcpb1/images/98/12/44/9812444c-cb6e-4c4d-9a87-5edf47b541f0?rule=bo-thumb"
    }
  },
  {
    id: "A3",
    title: "iPhone 15 Plus",
    price: "550,00 ‚Ç¨",
    oldPrice: "",
    disc: "",
    secure: true, // transaction s√©curis√©e r√©tablie
    likes: 9,
    desc: "iPhone 15 Plus en tr√®s bon √©tat g√©n√©ral. Vente avec c√¢ble. Disponible en boutique ou par livraison.",
    img: "https://img.leboncoin.fr/api/v1/lbcpb1/images/e5/34/93/e5349380cb51f69a05a9a9f9ca0af9cc0de34f8d.jpg?rule=ad-large",
    seller: {
      name: "PHONESTART",
      badges: [], // tous les badges retir√©s
      rate: 5.0,
      ads: 22,
      photo: ""
    }
  },
  {
    id: "A4",
    title: "iPhone 15 Pro Max",
    price: "690,00 ‚Ç¨",
    oldPrice: "766,67 ‚Ç¨",
    disc: "-10%",
    secure: true,
    likes: 18,
    desc: "T√©l√©phone enti√®rement fonctionnel, en bon √©tat. L√©g√®re rayure. C√¢ble inclus. Exp√©dition seulement.",
    img: "https://img.leboncoin.fr/api/v1/lbcpb1/images/01/1f/00/011f00ac2eaf872bb6cdf7f2cdbfd8bf8926ff99.jpg?rule=ad-large",
    seller: {
      name: "UNIVACK",
      badges: ["Particulier", "Top Vendeur"], // incoh√©rence volontaire conserv√©e
      rate: 5.0,
      ads: 39750,
      photo: ""
    }
  },
  {
    id: "A5",
    title: "iPhone 15 Plus",
    price: "550,00 ‚Ç¨",
    oldPrice: "",
    disc: "",
    secure: false, // s√©curit√© retir√©e
    likes: 16,
    desc: "iPhone 15 en tr√®s bon √©tat. R√©initialis√©, pr√™t √† l‚Äôemploi. C√¢ble inclus.",
    img: "https://img.leboncoin.fr/api/v1/lbcpb1/images/a0/04/34/a004347f09407463ca104bd73f510935e8c3671f.jpg?rule=ad-large",
    seller: {
      name: "cireluz",
      badges: ["Pro"],
      rate: 4.6,
      ads: 13,
      photo: ""
    }
  },
  {
    id: "A6",
    title: "iPhone 11",
    price: "165,00 ‚Ç¨",
    oldPrice: "",
    disc: "",
    secure: true,
    likes: 3,
    desc: "iPhone 11 en √©tat satisfaisant. Fonctionnel. Accessoires inclus.",
    img: "https://img.leboncoin.fr/api/v1/lbcpb1/images/22/a7/ff/22a7ff5eedbab467c7d90ce452829aa469324d74.jpg?rule=ad-large",
    seller: {
      name: "FUTURX",
      badges: ["Pro"],
      rate: null, // avis retir√©s
      ads: 0,
      photo: ""
    }
  },
  {
    id: "A7",
    title: "iPhone 14 Pro",
    price: "150,00 ‚Ç¨",
    oldPrice: "",
    disc: "",
    secure: false, // garantie de paiement retir√©e
    likes: 13,
    desc: "T√©l√©phone neuf, bo√Æte jamais ouverte.",
    img: "",
    seller: {
      name: "Dude30",
      badges: ["R√©actif", "Identit√© v√©rifi√©e"],
      rate: null,
      ads: 2,
      photo: ""
    }
  },
  {
    id: "A8",
    title: "Huawei P30 Pro",
    price: "209,00 ‚Ç¨",
    oldPrice: "",
    disc: "",
    secure: true,
    likes: 17,
    desc: "Huawei P30 Pro neuf. Jamais utilis√©.",
    img: "https://img.leboncoin.fr/api/v1/lbcpb1/images/7f/bf/3b/7fbf3be309d7efc2dde6d32b06b6a90a1b330f71.jpg?rule=ad-large",
    seller: {
      name: "Enola",
      badges: ["Profil recommand√©"],
      rate: 5.0,
      ads: 14,
      photo: "https://img.leboncoin.fr/api/v1/tenants/9a6387a1-6259-4f2c-a887-7e67f23dd4cb/domains/20bda58f-d650-462e-a72a-a5a7ecf2bf88/buckets/21d2b0bc-e54c-4b64-a30b-89127b18b785/images/profile/pictures/73f89309-6ed7-5d1b-a34e-b44cb5e575c3?rule=pp-large"
    }
  },
  {
    id: "A9",
    title: "iPhone 15 Pro",
    price: "929,00 ‚Ç¨",
    oldPrice: "1327,14 ‚Ç¨",
    disc: "-30%",
    secure: true,
    likes: 14,
    desc: "T√©l√©phone test√© et fonctionnel. Accessoires non inclus.",
    img: "https://img.leboncoin.fr/api/v1/lbcpb1/images/0a/d8/a7/0ad8a7529da8ccacbe77ac5aeab7612fc48bdaae.jpg?rule=ad-large",
    seller: {
      name: "Maxime",
      badges: ["R√©actif", "Identit√© v√©rifi√©e", "Elite"], // badge elite + note faible
      rate: 3.1,
      ads: 100,
      photo: "https://img.leboncoin.fr/api/v1/tenants/9a6387a1-6259-4f2c-a887-7e67f23dd4cb/domains/20bda58f-d650-462e-a72a-a5a7ecf2bf88/buckets/21d2b0bc-e54c-4b64-a30b-89127b18b785/images/profile/pictures/7d675dac-40be-5280-84e8-ad15962dab9f?rule=pp-large"
    }
  }
];

  
function renderTrial() {
  const data = annonces[currentTrial];
  const container = document.getElementById("content");
  container.innerHTML = `
    <div class="card">
      <div class="seller">
        <img src="${data.seller.photo || 'https://via.placeholder.com/100?text=?'}" alt="Seller">
        <div class="info">${data.seller.name}</div>
        ${data.seller.badges.map(b => `<span class="badge ${b === 'Pro' ? 'pro' : ''}">${b}</span>`).join('')}
        <div class="rating">‚òÖ ${data.seller.rate || 'N/A'}</div>
        <div class="numListings">${data.seller.ads} annonces</div>
      </div>
      <div class="product">
        <div class="gallery-main"><img id="mainImg" src="${data.img}"></div>
        <div class="details">
          <h1>${data.title}</h1>
          <div class="price">${data.price} ${data.oldPrice ? `<span class="old">${data.oldPrice}</span><span class="discount">${data.disc}</span>` : ''}</div>
          
          ${data.secure ? '<div class="tag secure">üõ°Ô∏è Transaction s√©curis√©e</div>' : ''}
          
          <div class="tag">üì¶ Livraison ou main propre</div>
          <div class="description">${data.desc}</div>
          <button class="contact-btn" onclick="openClickModal()">√âvaluer cette annonce</button>
        </div>
      </div>
    </div>`;
}
function openClickModal() { modalClick.style.display = "flex"; }
function closeModal(id) { document.getElementById(id).style.display = "none"; }
function enableClickCapture() { closeModal('modalClick'); clickMode = "capture"; }

document.addEventListener("click", e => {
  if (clickMode !== "capture") return;
  if (e.target.closest('.modal-content') || e.target.classList.contains('contact-btn')) return;

  const dot = document.createElement("div");
  dot.className = "click-marker";
  dot.style.left = e.clientX + "px"; dot.style.top = e.clientY + "px";
  dot.innerHTML = `<div class="click-dot"></div>`;
  document.body.appendChild(dot);
  setTimeout(() => dot.remove(), 1000);

  clickData = { x: e.clientX, y: e.clientY, target: e.target.innerText || e.target.tagName };
  clickMode = "off";
  modalSurvey.style.display = "flex";
});

function startWarmUp() { modalWarmUp.style.display = "flex"; clickMode = "warmup"; }
function startStudy() { clickMode = "off"; renderTrial(); }

function submitTrial() {
  responses.push({
    id: currentTrial + 1,
    produit: annonces[currentTrial].title,
    clickX: clickData.x,
    clickY: clickData.y,
    clickTarget: clickData.target.substring(0, 20),
    trust: document.getElementById("trust").value,
    sellerTrust: document.getElementById("sellerTrust").value,
    contact: document.getElementById("contactLikely").value,
    reason: document.getElementById("reason").value.replace(/,/g, " ")
  });

  closeModal('modalSurvey');
  // Reset fields
  document.getElementById("trust").value = ""; document.getElementById("sellerTrust").value = "";
  document.getElementById("contactLikely").value = ""; document.getElementById("reason").value = "";

  currentTrial++;
  if (currentTrial < annonces.length) renderTrial(); else showFinalSurvey();
}

function showFinalSurvey() {
  document.getElementById("content").innerHTML = "";
  const select = document.getElementById("mostTrusted");
  annonces.forEach((a, i) => {
    let opt = document.createElement("option"); opt.value = a.title; opt.text = a.title; select.add(opt);
  });
  modalPhaseC.style.display = "flex";
}

function submitPhaseC() {
  const final = {
    best: document.getElementById("mostTrusted").value,
    factor: document.getElementById("mostInfluential").value
  };
  closeModal('modalPhaseC');
  
  // Message de transition
  document.getElementById("content").innerHTML = "<h2>Merci ! Vos r√©sultats ont √©t√© g√©n√©r√©s. Redirection en cours...</h2>";
  
  // 1. G√âN√âRATION ET EXPORT DU CSV
  let csv = "ID,Produit,Clic_X,Clic_Y,Element_Clique,Trust_Annonce,Trust_Vendeur,Contact,Commentaire\n";
  responses.forEach(r => {
    csv += `${r.id},${r.produit},${r.clickX},${r.clickY},${r.clickTarget},${r.trust},${r.sellerTrust},${r.contact},${r.reason}\n`;
  });
  csv += `\nBILAN FINAL\nMeilleure Annonce,${final.best}\nFacteur Principal,${final.factor}`;

  const blob = new Blob([csv], { type: 'text/csv' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'phase2.csv';
  document.body.appendChild(a); 
  a.click();
  document.body.removeChild(a);

  setTimeout(function() {
    window.location.href = "phase3.html";
  }, 2000);
}
</script>
</body>
</html>
